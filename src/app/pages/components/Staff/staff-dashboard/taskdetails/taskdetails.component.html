
<app-stafftoolbar (toggleSidebarForMe)="sideBarToggler()"></app-stafftoolbar>
<mat-drawer-container>
    <mat-drawer mode="side" [opened]="sideBarOpen">
        <app-staffsidenav></app-staffsidenav>
    </mat-drawer>
    <mat-drawer-content>
        <router-outlet></router-outlet>
        
           <section class="">
            <div class="container">

                
               

                <body >
                    <main>
                      
                        
                      
                
                       
                       
                        
                        
                        
                       
                      <div class="title" style="margin-top: 10px;">
                        <h1><span>ACCOMPLISHMENTS</span> TABLE</h1>
                        

                        
                    </div>
                     
                          
                    </main>

                    <div class="container" style="margin-top: -70px;">
                        <!-- Task Details Header -->
                        <div class="task-header card p-4 mb-4">
                          
                            <div class="task-info-grid">
                                <div class="info-item">
                                    <strong>Task Name:</strong>
                                    <span style="text-transform: uppercase;">{{tasks.pt_task_name}}</span>
                                </div>
                                <div class="info-item">
                                    <strong>Task Category:</strong>
                                    <span style="text-transform: uppercase;">{{categoryName}}</span>
                                </div>
                                <div class="info-item">
                                    <strong>Starting Date:</strong>
                                    <span>{{tasks.pt_starting_date | date:'MM-dd-yyyy'}}</span>
                                </div>
                                <div class="info-item">
                                    <strong>Completion Date:</strong>
                                    <span>{{tasks.pt_completion_date | date:'MM-dd-yyyy'}}</span>
                                </div>
                                <div class="info-item">
                                    <strong>Status:</strong>
                                    <span [ngClass]="{
                                        'badge-ongoing': getStatusText(tasks.pt_status) === 'Ongoing',
                                        'badge-complete': getStatusText(tasks.pt_status) === 'Complete',
                                        'badge-due': getStatusText(tasks.pt_status) === 'Due'
                                    }" class="badge">{{getStatusText(tasks.pt_status)}}</span>
                                    
                                </div>
                            </div>
                        </div>

                        <div class="col-12"><div class="table-wrapper card p-4 mb-4">
                            <h2 >Accomplishments <button class="btn btn-outline-dark" *ngIf="tasks.pt_status !=='C'" style="margin-left: 20px;"  (click)="openTaskModal(tasks.id)" >
                                Update Task </button>
                                  <app-archi *ngIf="isTaskOpen" (close)="closeTaskModal()"></app-archi>
                                  
                                <button class="btn btn-outline-dark" *ngIf="tasks.percentage >= 95 && tasks.pt_status !== 'C'" style="margin-left: 20px;" (click)="CompleteTask(tasks.id)">
                                   Complete Task </button>
                        
                            </h2>
                         
                            <table class="table modern-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Description</th>
                                        <th>Resources Name</th>
                                        <th>Qty</th>
                                        <th>Resources Left</th>
                                        <th>Staff</th>
                                        <th>Date</th>
                                        <th>Day</th>
                                        <th>Picture</th>
                                        <th *ngIf="tasks.pt_status !=='C'">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let resource of resources; let i =index">
                                        <td>{{i + 1}}</td>
                                        <td style="text-transform: uppercase;">{{resource.resource_name}}</td>
                                        <td>{{resource.qty}}</td>
                                        <td>{{resource.qty}}</td>
                                        <td>{{resource.qty}}</td>
                                        <td>{{resource.qty}}</td>
                                        <td>{{resource.qty}}</td>
                                        <td> <div class="cards project-item card-custom m-3" *ngFor="let task of task_image" (click)="openModal(task.images)">
                                            <img [src]="'http://localhost:8000' + task.mainImage" alt="Project Image" class="card-image">
                                            
                                          </div> </td>
                                        <td>{{resource.left_qty}}</td>
                                        <td style="text-align: center;"> 
                                            <a class="btn btn-outline-dark" (click)="openEditSubModal(resource.id)" class="view" *ngIf="tasks.pt_status !=='C'">Edit</a>
                                            <app-editresource *ngIf="isEditSubModalOpen"
                                            [resourceId]="selectedResource!"
                                            (close)="closeEditSubModal()"></app-editresource>
                                        </td>
                                        
                                    </tr>
                                </tbody>
                            </table>
                        </div></div>

                        <div class="row">
                             <!-- Estimated Materials Section -->
                         <div class="col-6"><div class="table-wrapper card p-4 mb-4">
                            <h2 >Estimated Resources <button class="btn btn-outline-dark" *ngIf="tasks.pt_status !=='C'" style="margin-left: 20px;"  (click)="openTaskModal(tasks.id)" >
                                Update Task </button>
                                  <app-archi *ngIf="isTaskOpen" (close)="closeTaskModal()"></app-archi>
                                  
                                <button class="btn btn-outline-dark" *ngIf="tasks.percentage >= 95 && tasks.pt_status !== 'C'" style="margin-left: 20px;" (click)="CompleteTask(tasks.id)">
                                   Complete Task </button>
                        
                            </h2>
                         
                            <table class="table modern-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Resources Name</th>
                                        <th>Quantity</th>
                                        <th>Resources Left</th>
                                        <th *ngIf="tasks.pt_status !=='C'">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let resource of resources; let i =index">
                                        <td>{{i + 1}}</td>
                                        <td style="text-transform: uppercase;">{{resource.resource_name}}</td>
                                        <td>{{resource.qty}}</td>
                                        <td>{{resource.left_qty}}</td>
                                        <td style="text-align: center;"> 
                                            <a class="btn btn-outline-dark" (click)="openEditSubModal(resource.id)" class="view" *ngIf="tasks.pt_status !=='C'">Edit</a>
                                            <app-editresource *ngIf="isEditSubModalOpen"
                                            [resourceId]="selectedResource!"
                                            (close)="closeEditSubModal()"></app-editresource>
                                        </td>
                                        
                                    </tr>
                                </tbody>
                            </table>
                        </div></div>

                        <div class="col-6">
                            <div class="table-wrapper card p-4 mb-4">
                                <h2>History Logs</h2>   
                                
                                <table class="table modern-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Resources Name</th>
                                            <th>Resources Used</th>
                                            <th>Staff</th>
                                            <th>Used At</th>
                                         
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let use of used_resources; let i =index">
                                            <td>{{i + 1}}</td>
                                            <td style="text-transform: uppercase;">{{use.used_resource_name}}</td>
                                            <td>{{use.resource_qty}}</td>
                                            <td style="text-transform: uppercase;">{{use.first_name}} {{use.last_name}}</td>
                                            <td>{{use.created_at | date:'MM-dd-yyyy'}}</td>
                                            
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        </div>
                    
                       
                        

                        <div class="container">
                            <div class="cards-container d-flex flex-wrap justify-content-center">
                              <div class="cards project-item card-custom m-3" *ngFor="let task of task_image" (click)="openModal(task.images)">
                                <img [src]="'http://localhost:8000' + task.mainImage" alt="Project Image" class="card-image">
                                <div class="project-details">
                                  <h3><strong>{{task.uploaded_at}}</strong></h3>
                                  <h3><strong>{{task.day}}</strong></h3>
                                  <h3 style="margin-top: -30px; margin-bottom: -10px;"><strong>Completed</strong></h3>
                                </div>
                              </div>
                            </div>
                          </div>
                          
                          <app-image-modal [images]="selectedImages" [isVisible]="isModalVisible" (close)="closeModal()"></app-image-modal>
                    
                        <!-- Used Materials Section -->
                        








                    </div>
                    
                    
                    
                 
                 
                </body>
               
                
               
             
            </div>
            
          
           </section>
           

       
          
            
        
        <router-outlet></router-outlet>
    </mat-drawer-content>
</mat-drawer-container>